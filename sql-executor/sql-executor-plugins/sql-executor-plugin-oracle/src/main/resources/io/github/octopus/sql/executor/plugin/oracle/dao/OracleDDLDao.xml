<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.octopus.sql.executor.plugin.oracle.dao.OracleDDLDao">

    <update id="createTable" parameterType="table">
        CREATE TABLE <if test="databaseName != null">${databaseName}.</if>${tableName}(
        <foreach item="item" index="index" collection="columnDefinitions"
                 separator=",">
            ${item.columnName} ${item.fieldType}
            <if test="!item.isNullable()">NOT NULL</if>
        </foreach>
        <if test="primaryKey != null">
            ,
            CONSTRAINT ${primaryKey.primaryKeyName} PRIMARY KEY
            <foreach collection="primaryKey.columns" item="item" index="index" open="(" close=")" separator=",">
                ${item}
            </foreach>
        </if>
        <if test="constraintDefinitions != null and !constraintDefinitions.isEmpty()">
            ,
            <foreach item="item" index="index" collection="constraintDefinitions"
                     separator=",">
                CONSTRAINT ${item.name} ${item.type}
                <foreach collection="item.constraints" item="column" index="index" open="(" close=")" separator=",">
                    ${column}
                </foreach>
            </foreach>
        </if>
        )
    </update>

    <update id="renameTable">
        RENAME TABLE <if test="database != null">${database}.</if>${oldTable} TO <if test="database != null">
        ${database}.</if>${newTable}
    </update>

    <update id="modifyTableComment">
        COMMENT ON TABLE <if test="database != null">${database}.</if>${table} is ${comment}
    </update>

    <update id="modifyColumnComment">
        COMMENT ON COLUMN <if test="database != null">${database}.</if>${table}.${column} is ${comment}
    </update>

    <update id="dropTable">
        DROP TABLE <if test="database != null">${database}.</if>${table}
    </update>

    <update id="addColumn" parameterType="table">
        ALTER TABLE <if test="databaseName != null">${databaseName}.</if>${tableName}
        ADD
        <foreach item="item" index="index" collection="columnDefinitions"
                 separator=",">
            ${item.columnName} ${item.fieldType}
            <if test="!item.isNullable()">NOT NULL</if>
        </foreach>
    </update>

    <update id="removeColumn">
        ALTER TABLE <if test="database != null">${database}.</if>${table} DROP COLUMN ${column}
    </update>

    <update id="modifyColumn">
        ALTER TABLE <if test="database != null">${database}.</if>${table}
        MODIFY ${column.columnName} ${column.fieldType}
        <if test="!column.isNullable()">NOT NULL</if>
    </update>

    <update id="renameColumn">
        ALTER TABLE <if test="database != null">${database}.</if>${table} RENAME COLUMN ${oldColumn} TO ${newColumn}
    </update>

    <update id="createIndex">
        CREATE <if test="index.algo != null">${index.algo}</if> INDEX ${index.indexName} ON <if test="database != null">${database}.</if>${table}
        <foreach collection="index.columns" item="column" index="index" open="(" separator="," close=")">
            ${column}
        </foreach>
    </update>

    <update id="dropIndex">
        DROP INDEX <if test="database != null">${database}.</if>${index}
    </update>

    <update id="executeSQL">
        ${sql}
    </update>

</mapper>
